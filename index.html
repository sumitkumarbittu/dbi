<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Postgres File Injector</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üêò Postgres File Injector</h1>
            <div class="status-badge" id="statusBadge">
                <div class="status-dot disconnected" id="statusDot"></div>
                <span id="statusText">Render: Disconnected</span>
            </div>

            <!-- API Selection -->
            <div class="api-selector" id="apiSelector">
                <div class="api-label">API Base:</div>
                <div class="api-boxes" id="apiBoxes"></div>
            </div>
        </div>

        <!-- Database Connection -->
        <div class="card">
            <div class="card-title">üîå Database Connection</div>
            <div class="input-group" id="dbUrlGroup">
                <label>PostgreSQL Connection URL</label>
                <div id="dbUrlDisplay" class="hidden">
                    <div class="db-url-display">
                        <span id="dbUrlText">Not configured</span>
                        <button class="btn btn-icon btn-secondary" onclick="editDbUrl()">‚úèÔ∏è</button>
                    </div>
                </div>
                <div class="input-wrapper" id="dbUrlInput">
                    <input type="text" id="dbUrl" placeholder="postgresql://user:password@host:port/database">
                    <button class="btn btn-primary" onclick="saveDbConnection()">üíæ Save</button>
                </div>
            </div>
        </div>

        <!-- Create Table -->
        <div class="card">
            <div class="card-title">
                üìã Table Management
                <button class="btn btn-secondary" style="margin-left: auto;" onclick="toggleCreateTable()">
                    <span id="createTableBtnText">‚ûï Create Table</span>
                </button>
            </div>

            <div class="schema-section hidden" id="schemaSection">
                <div class="input-group">
                    <label>SQL Schema</label>
                    <textarea id="createTableSql" placeholder="CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE
);"></textarea>
                </div>
                <button class="btn btn-primary" onclick="executeCreateTable()">‚ö° Execute</button>
            </div>
        </div>

        <!-- Table Schema Info -->
        <div class="card">
            <div class="card-title">üìä Table Schema</div>
            <div class="input-group">
                <label>Table Name</label>
                <div class="input-wrapper">
                    <input type="text" id="tableName" placeholder="users">
                    <button class="btn btn-primary" onclick="fetchTableSchema()">üîç Set</button>
                </div>
            </div>

            <div class="info-grid" id="schemaInfo" style="display: none;">
                <div class="info-box">
                    <label>Primary Key</label>
                    <div class="value" id="primaryKey">-</div>
                </div>
                <div class="info-box">
                    <label>Attributes</label>
                    <div class="value" id="attributes">-</div>
                </div>
            </div>
        </div>

        <!-- File Upload -->
        <div class="card hidden" id="uploadCard">
            <div class="card-title">üì§ Upload Data</div>

            <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÅ</div>
                <h3>Drop your file here or click to browse</h3>
                <p style="color: #6b7280; margin-top: 10px;">Supports CSV and JSON files</p>
            </div>

            <input type="file" id="fileInput" accept=".csv,.json" style="display: none;"
                onchange="handleFileSelect(event)">

            <div id="fileInfoSection" class="hidden">
                <div class="file-info">
                    <div>
                        <strong>Selected:</strong> <span id="fileName"></span>
                        <div style="color: #6b7280; font-size: 0.9rem; margin-top: 5px;">
                            <span id="fileSize"></span>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button class="btn btn-secondary" onclick="verifyFile()">‚úÖ Verify</button>
                        <button class="btn btn-primary" onclick="uploadFile()">üöÄ Upload</button>
                    </div>
                </div>

                <div class="mapping-section hidden" id="mappingSection">
                    <div style="font-weight: 800; color: #1f2937;">Attribute Mapping</div>
                    <div style="color: #6b7280; font-size: 0.9rem; margin-top: 6px;">
                        Table attributes are fixed. Select the CSV column to map into each table attribute.
                    </div>
                    <div id="mappingRows"></div>
                </div>

                <div class="preview-card hidden" id="previewCard">
                    <div style="display:flex; align-items:center; justify-content: space-between; gap: 10px;">
                        <div>
                            <div style="font-weight: 800; color: #1f2937;" id="previewTitle">Preview</div>
                            <div style="color: #6b7280; font-size: 0.9rem; margin-top: 4px;">
                                Showing <span id="previewRange">1-10</span>
                                <span id="selectedCounter" class="selected-counter hidden">| <span
                                        id="selectedCount">0</span> rows selected</span>
                            </div>
                        </div>
                        <div style="display:flex; gap: 10px; flex-wrap: wrap; justify-content: flex-end;">
                            <button class="btn btn-secondary" id="previewToggleBtn"
                                onclick="togglePreviewMode()">Matched</button>
                            <button class="btn btn-secondary" onclick="selectAllRows()">Select All</button>
                            <button class="btn btn-secondary" onclick="clearSelection()">Clear</button>
                            <button class="btn btn-secondary" onclick="previewPrev()">-10</button>
                            <button class="btn btn-secondary" onclick="previewNext()">+10</button>
                        </div>
                    </div>
                    <div style="max-height: 280px; overflow: auto; border-radius: 10px;">
                        <table class="preview-table" id="previewTable"></table>
                    </div>
                </div>
            </div>

            <div id="jobStatusSection" class="hidden"></div>
        </div>

        <!-- Job Cards Container -->
        <div id="jobCardsContainer" class="job-cards-container"></div>
    </div>

    <script src="script.js"></script>
    <script src="track.js"></script>
</body>

</html>